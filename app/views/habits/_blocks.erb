
<% selected_tag = params[:tag] || ('priority' if habits.tags_a.include?('priority') && !params.keys.include?('all_tags')) %>

<% habits.tags_a.sort_by { |tag| tag == 'priority' ? 0 : 1 }.each { |tag| %>
  <a href="<%= selected_tag == tag ? "?all_tags" : "?tag=#{tag}"%>" class="text-white label <%= selected_tag == tag ? 'label-primary' : 'label-default' %>" style="text-decoration: none"><%=tag%></a>
<% } %>
  

<h3 class="my-3">
  <a href="?date=<%=(@date-1).to_s(:db)%>"><i class="fa fa-chevron-left"></i></a>
  <%= @date %>
  <% unless @date == Date.current %>
    <a href="?date=<%=(@date+1).to_s(:db)%>"><i class="fa fa-chevron-right"></i></a>
  <% end %>
</h3>


<style>
  h4.block-title { font-size: 1.25rem }
  @media(max-width: 768px) { 
    h4.block-title { font-size: 5vw }
  }
</style>
<div class="row mt-3" id="habits">
  <% habits = habits.where(tags: /#{selected_tag}/) if selected_tag %>
  <% habits.order('o asc').each { |habit| %>  
    <div data-pagelet-url="/habits/<%=habit.id%>/block?date=<%=@date.to_s(:db)%>" class="habit col-6 col-sm-3 mb-3 <%=block_class if defined?(block_class)%>" id="<%=habit.id%>">
      <%= partial :'habits/block', :locals => {:habit => habit, :date => @date} %>
    </div>
  <% } %>
</div>

<% if !@account %>
  <script>
    $(function () {
      if ($(window).width() > 768) {
        $("div#habits").sortable({
          helper: 'clone',
          update: function (event, ui) {
            $.post('/habits/order', {habit_ids: $(event.target).sortable("toArray")})
          }
        });
      }
    })
  </script>
<% end %>