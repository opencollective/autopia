
<script>
  $(function () {
    $('#network-habits').load('/habits/network')
  })
</script>

<a class="btn btn-primary" href="javascript:;" onclick="$(this).hide().next().show().find('input').focus()"><i class="fa fa-plus-circle"></i> Add habit</a>
<div style="display: none">
  <%= partial :'habits/build' %>
</div>

<div class="row">

  <div class="col-sm-7">
    <%= partial :'habits/blocks', :locals => {:block_class => 'col-sm-6'} %>
  </div>

  <div class="col-sm-5">

    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="network-habits-tab" data-toggle="tab" href="#network-habits" role="tab">Friends</a>
      </li>  
      <li class="nav-item">
        <a class="nav-link" id="my-habits-tab" data-toggle="tab" href="#my-habits" role="tab">You</a>
      </li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane fade show active" id="network-habits" role="tabpanel">
        <i class="my-3 fa fa-spin fa-circle-o-notch"></i>
      </div>  
      <div class="tab-pane fade" id="my-habits" role="tabpanel">
        <% @dates.each { |date| %>
          <h3 class="mt-3"><%=date.to_s(:no_year)%></h3>  
          <% if current_account.habit_completions.where(date: date).count == 0 %>
            <em>No habits completed on this day</em>
          <% end %>
          <ul class="fa-ul">
            <% @habits.order('o asc').each { |habit| %>
              <% if completed = habit.habit_completions.find_by(:date => date) %>
                <li>
                  <% if habit.public? %>
                    <i class="fa fa-li fa-check"></i>
                  <% else %>
                    <i class="fa fa-li fa-lock"></i>
                  <% end %>
                  <a href="/habits/<%=habit.id%>"><%= habit.name %></a><% if completed.comment %>: <%= completed.comment %><% end %>              
                </li>  
              <% end %>
            <% } %>
          </ul>
        <% } %>

      </div>
    </div>
  </div>